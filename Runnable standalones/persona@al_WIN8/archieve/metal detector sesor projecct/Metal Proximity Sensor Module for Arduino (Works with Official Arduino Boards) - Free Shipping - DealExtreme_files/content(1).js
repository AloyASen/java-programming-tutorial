(function(b,a,c,d){c.extend(true,a.Global.ns("Pattaya.Mall.Product.Detail"),{Lang:{__culture:"en",NoDataFound:'\u003cp style="margin: 10px;"\u003eNo data found yet.\u003c/p\u003e',SeeAllPhotos:"See all {0} photos",UploadYourPhoto:"upload yours",BeTheFirstToPostPhoto:'\u003cp class="none_info"\u003eNo Photos! Be the first to \u003ca href="{0}" target="_blank"\u003ePost a Photo\u003c/a\u003e of this product! and get DX points!\u003c/p\u003e',SeeAllVideos:"See all {0} videos",UploadYourVideo:"upload yours",BeTheFirstToPostVideo:'\u003cp class="none_info"\u003eNo Videos! Be the first to \u003ca href="{0}" target="_blank"\u003ePost a Video\u003c/a\u003e of this product! and get DX points!\u003c/p\u003e',ReviewPostedOn:"on",Or:"or",DiscussionReplies:"Replies",DiscussionViews:"Views",CustomersWhoViewedThisItemAlsoViewed:"Customers Who Viewed This Item Also Viewed",CustomersWhoBoughtThisItemAlsoBought:"Customers Who Bought This Item Also Bought",EmailIsRequired:"The filed E-mail is required",EmailAppearsToBeInvalid:"This email appears to be invalid",URLIsRequired:"The filed URL is required",UrlAppearsToBeInvalid:"This Url appears to be invalid",ValidationCodeIsWrong:"It seems the validation code is wrong",VerificationCodeCantForEmpty:"Verification code can't for empty",WeReallyAppreciateYourHelp:"We really appreciate your help.",ServerError:"Server Error",YourReportHasBeenSent:"Your report has been sent!",YourReportOnThisProductHasBeenSentToUs:"Thank you! Your report on this product has been sent to us. If we are able to work with our supplier to lower the price we will update the website (typically within 48 hours Mon-Fri).",PleaseInputAnEnglishWord:"Invalid content, please input an English word",PriceMatch:"Price Match",ReportError:"Report Error",CorrectErrorTitle:"Correct Errors",Loading:"loading",Submit:"Submit",PleaseInputYourReply:"please input your reply.",InputNoMoreThan:"please input no more than 500 characters.",UnknownErrorHappened:"unknown error happened",AddSucceeded:"Add succeeded",By:"By",YouToldUs:"you've told us",Warning:"Warning",ViewInEnglish:"View in English",ViewInOtherLang:"View in other language",ViewCartAndCheckout:"View Cart & Checkout",ContinueShopping:"Continue Shopping",Item:"item",Items:"items",ItemsAddedToCart:"{0} {1} added to cart",totalItemsInYourCart:"<b>{0}</b> total {1} in your Cart",CartTotal:"Cart Total"}})}(this,Pattaya,jQuery));
(function(window,Pattaya,$,undefined){var _ns=Pattaya.Global.ns("Mall.Product",Pattaya);_ns.anchorTabs||(function(){var DATA_KEY="pattaya-global-ui-anchorTabs";var anchorTabs=function(selector,options){var $tab=$(selector);var changing=false;var tabTopH=$tab.offset().top;options=$.extend(true,{active:-1,trigger:"click",triggerInterval:150,onChanging:undefined,onChanged:undefined,fixClassName:"cate_tabwrap_fixed",scrollOffSet:30},options);var fixClassName=options.fixClassName;var arrAnchor=[];var DATA_TABS_TRIGGER_TIMEOUT="data-anchorTabs-trigger-timeout",activate=function(element,container){container.find("> .active").removeClass("active");element.addClass("active")},_findAnchorItem=function(href){for(var i=0;i<arrAnchor.length;i++){var item=arrAnchor[i];if(item[1].attr("id")===href.attr("id")){return item}}return null},anchorTab=function(e){var $this=$(this),$ul=$this.closest("ul"),href=$this.attr("href"),previous,$href;if(href.indexOf("#")>0){var index=href.indexOf("#");href=href.substring(index)}if(/^#\w+/.test(href)){e&&e.preventDefault();previous=$ul.find(".active a").last()[0];if(options.onChanging&&options.onChanging(previous,this)===false){return}$href=$(href);activate($this.parent("li"),$ul);if(!$tab.hasClass(fixClassName)){$tab.addClass(fixClassName)}var item=_findAnchorItem($href);var triggerTop=$this.offset().top-$(window).scrollTop();var targetTop=Math.ceil($href.offset().top);var offset=targetTop-triggerTop;offset-=((item!=null&&item[3]>0)?item[3]:0)+options.scrollOffSet;changing=true;$("html,body").animate({scrollTop:offset},{duration:300,complete:function(){changing=false}});if(options.onChanged){options.onChanged(previous,this)}}},init=function(){$(selector).each(function(index){var $this=$(this),arrTrigger=options.trigger.split(" ");var ul=$this.children("ul");if(ul&&ul.length==1){ul.children("li").each(function(){var that=$(this),href=that.children("a").attr("href");if(/^#\w+/.test(href)){var $href=$(href);arrAnchor.push([that,$href,$href.offset().top,0])}});arrAnchor.sort(function(a,b){var left=a[2],reght=b[2];return left===reght?0:left<reght?-1:1});if(arrAnchor.length>0){arrAnchor[0][3]=Math.abs($(".tab_content").offset().top-arrAnchor[0][2])}}$.each(arrTrigger,function(index,trigger){if($.inArray(trigger,["mouseover","mouseenter"])<0){$this.on(trigger,"li > a",anchorTab)}else{$this.on("mouseover","li > a",function(){var curTrigger=$(this);if(options.triggerInterval){curTrigger.data(DATA_TABS_TRIGGER_TIMEOUT,setTimeout(function(){anchorTab.call(curTrigger)},options.triggerInterval))}else{anchorTab.call(curTrigger)}}).on("mouseout","li > a",function(){var timeout=$(this).data(DATA_TABS_TRIGGER_TIMEOUT);if(timeout){clearTimeout(timeout)}})}});if(options.active!=-1){$("li > a",$this).eq(options.active).trigger(arrTrigger[0])}});$(window).scroll(function(){if(changing){return}var scrollHight=$(this).scrollTop();var anchorLength=arrAnchor.length;var lastItem=arrAnchor[anchorLength-1][1];var lastHeight=lastItem.offset().top+lastItem.height();if(scrollHight<tabTopH){if($tab.hasClass(fixClassName)){$tab.removeClass(fixClassName)}}else{if(scrollHight>=tabTopH){if(!$tab.hasClass(fixClassName)){$tab.addClass(fixClassName)}}}var hit=false;for(var i=anchorLength-1;i>=0;i--){var item=arrAnchor[i];var offset=(item[3]>0?item[3]:0)+options.scrollOffSet;var triggerTop=item[0].offset().top+offset;var targetTop=Math.floor(item[1].offset().top);var targetHeight=item[1].height();if(triggerTop>=targetTop&&triggerTop<=(targetTop+targetHeight)){item[0].addClass("active").siblings().removeClass("active");hit=true;break}item[0].removeClass("active")}if(!hit){if(triggerTop<targetTop){var first=arrAnchor[0][0];if(!first.hasClass("active")){first.addClass("active")}}}}).scroll()};init()};anchorTabs.__version="20111121";$.extend(true,_ns,{anchorTabs:anchorTabs})}());var productDetail={__version:"20120928"},_settings={addTagUrl:"",reviewRootUrl:"",reviewServiceUrl:"",reviewPhotoesBaseUrl:"",reviewVideosBaseUrl:"",customerPhotoListUrl:"",uploadPhotoUrl:"",customerVideoListUrl:"",uploadVideoUrl:"",reviewListUrl:"",forumServiceUrl:"",proInfoRealtimeUrl:"",proDirectInfoUrl:"",countryInfoUrl:"",biTrackingRootUrl:"",dxClubRootUrl:"",lbSettings:{title:"",largestImageUrl:""},recommendProductSettings:{url:"",titleSize:0},affiliateAdStatisticsRootUrl:"",reportErrorUrl:"",reportLowerPriceUrl:"",addProductTagsUrl:"",reportErrorSubmitUrl:"",priceMatchSubmit:"",validationCodeUrl:"",fb:{seedUrl:"http://www.facebook.com/dialog/feed",app_id:"141676832590601",redirect_uri:"http://www.facebook.com/dealextremefans"}},_sku,_productStatus,_ctlQty,_isInitialized=false,_prosByUserBuyHistory,ProductStatus={Normal:"Normal",PreSale:"PreSale",PauseSale:"PauseSale",OffShelf:"OffShelf"},REVIEW_LIST_PATTERN="/reviews/{type}/{sku}",REVIEW_ADD_PATTERN="/reviews/{type}/{sku}/add",REVIEW_DETAIL_PATTERN="/reviews/{type}/{sku}/{id}",REVIEW_LIST_BY_USER_PATTERN="/reviews/{type}/u/{user}",FORUM_LIST_PATTERN="/forums/Forums.dx/Forum.{sku}",_this=function(){return Pattaya.Global.ns("Detail",_ns)},_preInit=function(){_sku=$.trim($("#sku").text());_productStatus=$("#productStatus").val();var format=Pattaya.Global.Utils.format;_settings.uploadPhotoUrl=_settings.dxClubRootUrl+format(REVIEW_ADD_PATTERN,{sku:_sku,type:"photos"});_settings.customerPhotoListUrl=_settings.dxClubRootUrl+format(REVIEW_LIST_PATTERN,{sku:_sku,type:"photos"});_settings.uploadVideoUrl=_settings.dxClubRootUrl+format(REVIEW_ADD_PATTERN,{sku:_sku,type:"videos"});_settings.customerVideoListUrl=_settings.dxClubRootUrl+format(REVIEW_LIST_PATTERN,{sku:_sku,type:"videos"});_settings.reviewListUrl=_settings.dxClubRootUrl+format(REVIEW_LIST_PATTERN,{sku:_sku,type:"text"});Pattaya.Mall.addViewHistory(_sku)},_calcSubTotal=function(newQty){var currencySymbol=$("#currencySymbol").text()+" ",price=$("#price").text();var decimalDelimiter=".";if(price.indexOf(",")!==-1){decimalDelimiter=",";price=price.replace(",",".")}price=parseFloat(price);if(isNaN(price)){return}var subTotal=price*(newQty||_ctlQty.currentValue());$("#subTotal").html(accounting.formatMoney(subTotal,currencySymbol,2,"",decimalDelimiter))},_loadProductDirectInfo=function(){$.getJSON(_settings.proDirectInfoUrl).done(function(d){if(d.success){if(d.data.Direct){$("#directList").html(d.data.Direct)}if(d.data.OverviewTip){$("#directOverviewTip").html(d.data.OverviewTip)}}})},_loadCountryInfo=function(){$.getJSON(_settings.countryInfoUrl).done(function(d){if(d.success){$("#p-customer-country").html(d.DisplayName)}})},_loadProRealTimeInfo=function(){return $.getJSON(_settings.proInfoRealtimeUrl,{skus:_sku}).done(function(d){if(d.success){var data=d.data[0];if(data){$("#currencySymbol .cur_cy").text(data.currencysymbol);$("#price").text(data.price);if(data.adddate){$("#adddate").text(data.adddate)}if(data.listprice){$("#list-price").text(data.currencysymbol+data.listprice).closest("tr").show()}else{$("#list-price").closest("tr").hide()}if(data.isShowDiscount){$("#priceOff").text(data.discount).show()}else{$("#priceOff").hide()}if(data.issoldout){$("#qty").prop("disabled",true).val("0");$("storageInfo").show();$("#btn-add-to-cart").attr("href","javascript:void(0)").addClass("disable")}else{$("#qty").prop("disabled",false).val("1");$("storageInfo").hide();var href=$("#btn-add-to-cart").data("href");if(href){$("#btn-add-to-cart").attr("href",href).removeClass("disable")}}}}})},_loadQtyControl=function(min,max){_ctlQty=Pattaya.Global.UI.numerical("#qty",{min:min,max:max,decCtrl:"#qty-dec",incCtrl:"#qty-inc",onValueChanged:undefined})},_loadPriceSelection=function(){var dd=Pattaya.Global.UI.dropdown("#price-selector",{type:"menu",trigger:"mouseover",delay:200,onChanged:function($item){var currencyCode=$.trim($item.data("currency-code"));Pattaya.Global.Page.Header.setDXGlobalCookies("currency",currencyCode);window.location.reload()}})},_loadTabs=function(){Pattaya.Mall.Product.anchorTabs(".cate_tabwrap",{trigger:"click"})},_loadAddToCart=function(){if(_productStatus===ProductStatus.OffShelf||_productStatus===ProductStatus.PauseSale){return}$("a#btn-add-to-cart").click(function(e){var $a=$(this),url=$a.attr("href"),qty=$("#qty").val(),pattern=/~quantity\.\d+$/;if(pattern.test(url)){url=url.replace(pattern,"~quantity."+qty)}else{url+="~quantity."+qty}$a.attr("href",url)});$(function(){var _lang=Pattaya.Mall.Product.Detail.Lang;var HTML_POPUP_WRAPPER='<div id="detailAddToCartPanel" class="popup_addtocart_container"></div>',HTML_POPUP_CON='<div class="con"><div class="warning">{warning}</div><p class="title"><i class="icon_success_27x27"></i> {title} </p><p class="subtitle">{totalItems}, '+_lang.CartTotal+': <span class="em">{subTotal}</span></p><div class="opers"><a class="btn_n_orange mar_r10" href="{cartUrl}" target="_blank"><span class="t">'+_lang.ViewCartAndCheckout+'</span></a><a class="btn_n_white continueShopping" href="javascript:;"><span class="t">'+_lang.ContinueShopping+'</span></a></div></div><a class="close" href="javascript:;"></a>',HTML_POPUP_PROS='<div class="pros_con"><h3 class="pros_con_title">'+_lang.CustomersWhoBoughtThisItemAlsoBought+'</h3><div class="slides_container">{pros}</div></div>',HTML_POPUP_PROS_ITEM_P='<ul class="pros_con_list">{items}</ul>',HTML_POPUP_PROS_ITEM='<li><p class="pic"><a href="{proUrl}" title="{headLine}" target="_blank"><img src="{imageUrl}" /></a></p><p class="title"><a href="{proUrl}" title="{headLine}" target="_blank">{shortHeadline}</a></p><p class="price">{price}</p></li>',HTML_POPUP_LOADING='<div class="showloader"></div>',HTML_ERROR='<div class="error_box"><div class="error_panel"><i class="icon_error vtt"></i> <span class="error"></span></div><a class="close" href="javascript:;"></a></div>';var addToCartPopup,showPros=function(){var checkProsTimeout,renderRP=function(pros){var format=Pattaya.Global.Utils.format,length=pros.length,prosHtml="";for(var i=0;i<length/4;i++){var itemList="";for(var j=0;j<4&&(i*4+j)<length;j++){var item=pros[i*4+j];itemList+=format(HTML_POPUP_PROS_ITEM,{proUrl:item.rewriteUrl,imageUrl:item.imageUrl,headLine:item.headLine,shortHeadline:item.shortHeadline,price:item.price})}prosHtml+=format(HTML_POPUP_PROS_ITEM_P,{items:itemList})}$("#detailAddToCartPanel").append(format(HTML_POPUP_PROS,{pros:prosHtml}))},bindRP=function(){$("#detailAddToCartPanel .pros_con").slides({play:0,pause:0,slideSpeed:600,hoverPause:true,generatePagination:false,generateNextPrev:true})},checkPros=function(){if(_prosByUserBuyHistory){clearTimeout(checkProsTimeout);renderRP(_prosByUserBuyHistory);bindRP()}else{checkProsTimeout=setTimeout(function(){checkPros()},100)}};checkPros()},error=function(msg){var jqRetry=$(HTML_ERROR);if(msg){jqRetry.find(".error").html(msg)}else{jqRetry.find(".error").html('System error, please <a class="retry" href="javascript:;">retry</a>')}jqRetry.find(".retry").click(function(){ajaxAddToCart()}).end().find(".close").click(function(){addToCartPopup.hide()});$("#detailAddToCartPanel").html(jqRetry);$("#btn-add-to-cart").off("click").on("click",function(){addToCartPopup.show();return false})},ajaxAddToCart=function(urlRoot,urlPath){var addToCartPanel=$("#detailAddToCartPanel");addToCartPanel.html(HTML_POPUP_LOADING);$.ajax({url:urlRoot+urlPath,dataType:"jsonp"}).done(function(data){if(data.success){var format=Pattaya.Global.Utils.format,htmlSuccess,title=_lang.ItemsAddedToCart,totalItems=_lang.totalItemsInYourCart,warningInfo,warningCode;title=format(title,data.qty,data.qty==1?_lang.Item:_lang.Items);totalItems=format(totalItems,data.itemCount,data.itemCount==1?_lang.Item:_lang.Items);if(data.warning){warningInfo=data.warning.Message;warningCode=data.warning.ErrorCode}if(warningCode=="134251020"){$("#qty").val(data.qty);_ctlQty.unload();_loadQtyControl(1,data.qty);warningInfo=Pattaya.Global.Utils.format(warningInfo,data.qty)}htmlSuccess=format(HTML_POPUP_CON,{title:title,subTotal:data.subTotal,totalItems:totalItems,cartUrl:urlRoot,warning:warningInfo});addToCartPanel.html(htmlSuccess);if(warningInfo){$(".warning",addToCartPanel).show()}else{$(".warning",addToCartPanel).hide()}$(".close, .continueShopping",addToCartPanel).click(function(){addToCartPopup.hide()});showPros();Pattaya.Cart.MiniCart.reload()}else{if(data.error){$("#btn-add-to-cart").addClass("disable");var msg=data.error.Message?data.error.Message:_lang.UnknownErrorHappened;error(msg)}}}).fail(function(){error()})};$("a#btn-add-to-cart").click(function(){var that=$(this),href=that.attr("href"),urlRoot,urlPath="/ajax/add-cart?sku={sku}&quantity={qty}&flag=true&callback=?",sku=_sku,qty=$("#qty").val();if(that.hasClass("disable")){return false}var arr=href.match(/(\w+:)?(\/\/[^\:|\/]+\:?\d*)?.+add\.(\d+)(~qut\.)?(\d+)?/i);urlRoot=(arr[1]?arr[1]:"")+arr[2];urlPath=Pattaya.Global.Utils.format(urlPath,{sku:sku,qty:qty});$(HTML_POPUP_WRAPPER).appendTo("body");addToCartPopup=Pattaya.Global.UI.popup("#detailAddToCartPanel",{width:"523px",popupClass:"popup_addtocart detail",autoOpen:false});var left=that.closest(".choose_quantity").offset().left,top=that.closest(".choose_quantity").offset().top;addToCartPopup.pos({left:left,top:top});addToCartPopup.show();ajaxAddToCart(urlRoot,urlPath);return false})})},_loadImageViews=function(){var proPhoPanel=$(".product_photo"),midPicBox=$("#midPicBox"),arrImg=[],sPicLink=$(".small_photo li a",proPhoPanel);var bindLightBox=function(ele){ele.lightBox({imageArray:arrImg,txtTitle:_settings.lbSettings.title})};proPhoPanel.slides({container:"small_photo",prev:"t_prev",next:"t_next",generatePagination:false});sPicLink.each(function(){var that=$(this),opt=$.extend({},eval("("+$.trim(that.attr("rel"))+")")),TIMEOUT_HOVER="timeout_hover";arrImg.push([opt.sImg,opt.bImg]);var eHandle=function(){var a=midPicBox.find("a");if(a.attr("href")!=opt.bImg){var loadingPic=$(".picLoading",proPhoPanel);var objImagePreloader=new Image();objImagePreloader.onload=function(){loadingPic.hide();midPicBox.find("img").attr("src",opt.mImg).show();a.attr("href",that.attr("href"));bindLightBox(a);objImagePreloader.onload=function(){}};loadingPic.show();objImagePreloader.src=that.attr("href");that.parent().addClass("hovered");that.parent().siblings(".hovered").removeClass("hovered")}return false};that.click(eHandle).mouseover(function(){that.data(TIMEOUT_HOVER,setTimeout(eHandle,100))}).mouseout(function(){var timeout=that.data(TIMEOUT_HOVER);if(timeout){clearTimeout(timeout)}})});midPicBox.hover(function(){$(this).find(".viewMax").fadeIn(200)},function(){$(this).find(".viewMax").fadeOut(200)});if(arrImg.length==0){arrImg.push(["",midPicBox.find("a").attr("href")])}bindLightBox(midPicBox.find("a"))},_loadPerfectMatch=function(){var $checkbox=$(".perfect_match").find("[type=checkbox]"),$addToCart=$(".perfect_match").find(".add_to_cart a");$checkbox.each(function(index,val){if($(val).prop("checked")&&index!=0){$(val).prop("checked",false)}});$(".perfect_match").on("change",$checkbox,function(e){var price=Math.round($(e.target).data("price")*100);var sku=$(e.target).data("sku")+"-1";var $totalPrice=$(".perfect_match").find(".total_price"),currency=$totalPrice.data("currency"),total_price=Math.round($totalPrice.data("totalprice")*100),url=$addToCart.attr("href");var $items=$(".perfect_match").find(".items"),items=+$items.find("strong").text();if(!$.isNumeric(price)||!$.isNumeric(total_price)){return false}if($(e.target).prop("checked")){total_price+=price;items+=1;if(url.search(sku)==-1){url=url+","+sku}}else{total_price-=price;items-=1;url=url.replace(","+sku,"")}$totalPrice.attr("data-totalprice",total_price/100).data("totalprice",(total_price/100).toFixed(2));$totalPrice.find("strong").html("<b>"+currency+"</b>"+(total_price/100).toFixed(2));$items.find("strong").text(items);$addToCart.attr("href",url);if($("#btn-add-to-cart").hasClass("disable")){$addToCart.addClass("disable");return}if($(".perfect_match").find("[type=checkbox]:checked").length<=1){$addToCart.addClass("disable")}else{$addToCart.removeClass("disable")}});$(function(){var _lang=Pattaya.Mall.Product.Detail.Lang;var HTML_POPUP_WRAPPER='<div id="detailAddToCartPanel" class="popup_addtocart_container"></div>',HTML_POPUP_CON='<div class="con"><div class="warning">{warning}</div><p class="title"><i class="icon_success_27x27"></i> {title} </p><p class="subtitle">{totalItems}, '+_lang.CartTotal+': <span class="em">{subTotal}</span></p><div class="opers"><a class="btn_n_orange mar_r10" href="{cartUrl}" target="_blank"><span class="t">'+_lang.ViewCartAndCheckout+'</span></a><a class="btn_n_white continueShopping" href="javascript:;"><span class="t">'+_lang.ContinueShopping+'</span></a></div></div><a class="close" href="javascript:;"></a>',HTML_POPUP_PROS='<div class="pros_con"><h3 class="pros_con_title">'+_lang.CustomersWhoBoughtThisItemAlsoBought+'</h3><div class="slides_container">{pros}</div></div>',HTML_POPUP_PROS_ITEM_P='<ul class="pros_con_list">{items}</ul>',HTML_POPUP_PROS_ITEM='<li><p class="pic"><a href="{proUrl}" title="{headLine}" target="_blank"><img src="{imageUrl}" /></a></p><p class="title"><a href="{proUrl}" title="{headLine}" target="_blank">{shortHeadline}</a></p><p class="price">{price}</p></li>',HTML_POPUP_LOADING='<div class="showloader"></div>',HTML_ERROR='<div class="error_box"><div class="error_panel"><i class="icon_error vtt"></i> <span class="error"></span></div><a class="close" href="javascript:;"></a></div>';var addToCartPopup,error=function(msg){var jqRetry=$(HTML_ERROR);if(msg){jqRetry.find(".error").html(msg)}else{jqRetry.find(".error").html('System error, please <a class="retry" href="javascript:;">retry</a>')}jqRetry.find(".retry").click(function(){ajaxAddToCart()}).end().find(".close").click(function(){addToCartPopup.hide()});$("#detailAddToCartPanel").html(jqRetry);$addToCart.off("click").on("click",function(){addToCartPopup.show();return false})},ajaxAddToCart=function(urlRoot,urlPath){var addToCartPanel=$("#detailAddToCartPanel");addToCartPanel.html(HTML_POPUP_LOADING);$.ajax({url:urlRoot+urlPath,dataType:"jsonp"}).done(function(data){if(data.success){var format=Pattaya.Global.Utils.format,htmlSuccess,title=_lang.ItemsAddedToCart,totalItems=_lang.totalItemsInYourCart,warningInfo,warningCode;title=format(title,data.qty,data.qty==1?_lang.Item:_lang.Items);totalItems=format(totalItems,data.itemCount,data.itemCount==1?_lang.Item:_lang.Items);if(data.warning){warningInfo=data.warning.Message;warningCode=data.warning.ErrorCode}if(warningCode=="134251020"){$("#qty").val(data.qty);_ctlQty.unload();_loadQtyControl(1,data.qty);warningInfo=Pattaya.Global.Utils.format(warningInfo,data.qty)}htmlSuccess=format(HTML_POPUP_CON,{title:title,subTotal:data.subTotal,totalItems:totalItems,cartUrl:urlRoot,warning:warningInfo});addToCartPanel.html(htmlSuccess);if(warningInfo){$(".warning",addToCartPanel).show()}else{$(".warning",addToCartPanel).hide()}$(".close, .continueShopping",addToCartPanel).click(function(){addToCartPopup.hide()});Pattaya.Cart.MiniCart.reload()}else{if(data.error){$addToCart.addClass("disable");var msg=data.error.Message?data.error.Message:_lang.UnknownErrorHappened;error(msg)}}}).fail(function(){error()})};$addToCart.click(function(){var that=$(this),href=that.attr("href"),urlRoot,urlPath;if(that.hasClass("disable")){return false}var arr=href.match(/(\w+:)?(\/\/[^\:|\/]+\:?\d*)?.+addmany-cart(\?skus=\S*)?/i);urlRoot=(arr[1]?arr[1]:"")+arr[2];urlPath="/ajax/addmany-cart"+arr[3]+"&flag=true";$(HTML_POPUP_WRAPPER).appendTo("body");addToCartPopup=Pattaya.Global.UI.popup("#detailAddToCartPanel",{width:"470px",popupClass:"popup_addtocart detail popup_match",autoOpen:false});var left=that.closest(".infos").offset().left,top=that.closest(".infos").offset().top;addToCartPopup.pos({left:left-250,top:top+7});addToCartPopup.show();ajaxAddToCart(urlRoot,urlPath);return false})})},_loadSocialShares=function(){$('<div id="fb-root"></div><script>(function (d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) { return; }js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";fjs.parentNode.insertBefore(js, fjs);} (document, "script", "facebook-jssdk"));<\/script>').appendTo("body");var strHtml="";strHtml+='<div class="fb"><div class="fb-like" data-send="false" data-layout="box_count" data-width="55" data-show-faces="true" data-font="verdana"></div></div>';strHtml+='<div class="gl"><g:plusone size="tall"></g:plusone><script type="text/javascript" async="true" src="https://apis.google.com/js/plusone.js"><\/script></div>';var redditStr=_buildRedditButtonScript();strHtml+='<div class="dg">'+redditStr+"</div>";$("#share").append($(strHtml))},_buildOtherButtonScript=function(){return'<div class="addthis_toolbox addthis_floating_style addthis_counter_style" style="left:50px;top:50px;"><a class="addthis_counter"></a></div>'},_buildRedditButtonScript=function(){if("https:"==document.location.protocol){var base_url="https://redditstatic.s3.amazonaws.com"}else{var base_url="http://www.reddit.com/static"}var write_string='<iframe src="'+base_url+"/button/button2.html?width=51&url=";if(window.reddit_url){write_string+=encodeURIComponent(reddit_url)}else{write_string+=encodeURIComponent(window.location.href)}if(window.reddit_title){write_string+="&title="+encodeURIComponent(window.reddit_title)}if(window.reddit_target){write_string+="&sr="+encodeURIComponent(window.reddit_target)}if(window.reddit_css){write_string+="&css="+encodeURIComponent(window.reddit_css)}if(window.reddit_bgcolor){write_string+="&bgcolor="+encodeURIComponent(window.reddit_bgcolor)}if(window.reddit_bordercolor){write_string+="&bordercolor="+encodeURIComponent(window.reddit_bordercolor)}write_string+="&newwindow=1";write_string+="\" width=\"51\" scrolling='no' frameborder='0'></iframe>";return write_string},_interceptRequestResult=function(data,func){if(data&&data.error){return}func()},_bindNewReviews=function(){var lang=Pattaya.Mall.Product.Detail.Lang;var success=function(that,flg){var $num=Number(that.children("em").text()),$cur_num;if(flg===true){$cur_num=$num+1;that.children("em").css("color","#f60")}else{if($num>0){$cur_num=Number(that.children("em").text())-1}that.children("em").css("color","#999")}that.children("em").html($cur_num)},_error=function(msg){Pattaya.Global.UI.alert(msg,lang.Warning)},_readMoreHandler=function(event){var url=this.href,ajax_url=$(this).data("ajax-url"),$this=$(this),$font=$this.prev("font");if($this.hasClass("loading")){return false}if($this.hasClass("full-show")){$this.removeClass("full-show").addClass("shorthand-show").css("margin-left","5px").text("Hide");$font.show().prev(".shorthand").hide();$this.parent(".cnt").css("height","auto")}else{if($this.hasClass("shorthand-show")){$this.removeClass("shorthand-show").addClass("full-show").css("margin-left","").text("Read more");$font.hide().prev(".shorthand").show();$this.parent(".cnt").css("height","")}else{if($font.hasClass("full")){$font.show().prev(".shorthand").hide()}else{$this.addClass("loading");$.getJSON(ajax_url).done(function(data){if(data&&data.success){$font.addClass("shorthand").hide();$this.before("<font class='full'>"+data.info.Content+"</font>");$this.parent(".cnt").css("height","auto");$this.addClass("shorthand-show").css("margin-left","5px").text("Hide")}else{window.location.href=url}$this.removeClass("loading")}).fail(function(){$this.removeClass("loading");window.location.href=url})}}}event.preventDefault()},_helpfulHandle=function(reviewId,that){var url=Pattaya.Global.Utils.format(_settings.reviewRootUrl+"/reviews/helpful/{Unid}?jsoncallback=?",{Unid:reviewId});$.ajax({url:url,dataType:"json"}).done(function(data){switch(data.Code){case 100000:success(that,data.Result);break;case 3200003:Pattaya.LoginOrSignUp.login();break;case 1000005:_error(data.Description);break;default:_error(lang.YouToldUs);break}})},_unhelpfulHandle=function(reviewId,that){var url=Pattaya.Global.Utils.format(_settings.reviewRootUrl+"/reviews/unhelpful/{Unid}?jsoncallback=?",{Unid:reviewId});$.ajax({url:url,dataType:"json"}).done(function(data){switch(data.Code){case 100000:success(that,data.Result);break;case 3200003:Pattaya.LoginOrSignUp.login();break;case 1000005:_error(data.Description);break;default:_error(lang.YouToldUs);break}})},_initHelpfullAndComments=function(){var commentUnids=$("[data-id]");var commentUnidsVal="";$(commentUnids).each(function(item,index){commentUnidsVal+=$(index).attr("data-id")+","});$.getJSON(_settings.reviewRootUrl+"/reviews/json/likescomments?jsoncallback=?",{reviewUnid:commentUnidsVal},function(json){$(commentUnids).each(function(item,index){var data=json.Result[$(index).attr("data-id")];if(data){$(index).find("em").html($(index).hasClass("r_like")?data.Helpfuls:data.UnHelpfuls);$(index).siblings(".r_news").find("em").html(data.Comments)}})})};_initHelpfullAndComments();var _anchorAnimate=function(e){var anchorId=$(e.target).attr("href");var targetTop=Math.ceil($(anchorId).offset().top);var offset=anchorId==="#overview"?targetTop-32:targetTop-62;$("html, body").animate({scrollTop:offset},{duration:300})};$(".pinfo_wrapper").find("a[href=#reviews], a[href=#discussions], a[href=#overview]").click(_anchorAnimate);$(".author").find(".s_starbox").hover(function(){var ratings=$(this).attr("data-ratings").split(",");if($(this).find("ul").length){$(this).addClass("cur").find("ul").show()}else{var tmp=$("#RatingControl").html().replace(/{{rating0}}/,ratings[0]).replace(/{{rating1}}/,ratings[1]).replace(/{{rating2}}/,ratings[2]).replace(/{{rating3}}/,ratings[3]).replace(/{{rating4}}/,ratings[4]);$(this).addClass("cur").append(tmp)}},function(){$(this).removeClass("cur").find("ul").hide()});$(".js-readmore").on("click",_readMoreHandler);$(".r_like, .rdetail_main .z").click(function(){var reviewId=$(this).attr("data-id"),$that=$(this);_helpfulHandle(reviewId,$that)});$(".r_unlike").click(function(){var reviewId=$(this).attr("data-id"),$that=$(this);_unhelpfulHandle(reviewId,$that)});$(".u_comment .c_hd .postComment").click(function(event){$(this).parent(".c_hd").next().slideDown()});$(".rdetail_main .postBar .slideUp").click(function(event){$(this).parents(".postBar").slideUp()});$(".allRev_bd .proImg .btn_addCart").click(function(event){$(this).hide();$(this).next().show()});$(".sortby").hover(function(){$(this).children("ul").show().end().children(".sb").addClass("cur")},function(){$(this).children("ul").hide().end().children(".sb").removeClass("cur")});$(".sortby ul li").click(function(event){$(".sortby .sb").text($(this).text());$(this).parent("ul").hide()});var load_img=function(imgUrl,loadimg,callback){loadimg.siblings("span").show();if(imgUrl.indexOf("youtube")==-1){var Img=new Image();Img.onload=function(){callback();loadimg.siblings("span").hide()};Img.src=imgUrl}else{callback();loadimg.siblings("span").hide()}};function autloadSource(obj,source){if(source.indexOf("youtube")==-1){$(obj).attr("src",source).show();$(obj).next(".youtube").empty().hide()}else{$(obj).hide();$(obj).next(".youtube").show().html('<object width="100%" height="100%"><param value="'+source+'" name="movie"><param value="transparent" name="wmode"><embed width="100%" height="100%" wmode="transparent" type="application/x-shockwave-flash" src="'+source+'"></object>')}}$(".comments_list .pht a").click(function(event){$(this).parent().hide();$(this).parent().next(".pht_review").slideDown();var aIdx=$(this).index();if(aIdx===0){$(this).parent().next(".pht_review").find(".thumblist").children("a.prev").addClass("cur")}else{$(this).parent().next(".pht_review").find(".thumblist").children("a.prev").removeClass("cur")}$(this).parent().next(".pht_review").find(".list").find("li").eq(aIdx).addClass("cur").siblings("li").removeClass("cur");var $imgSrc=$(this).attr("data-big"),$bigImg=$(this).parent().next(".pht_review").find(".scroll_big_img");load_img($imgSrc,$bigImg,function(){autloadSource($bigImg,$imgSrc)})});$(".comments_list .pht_review .close").click(function(event){$(this).parent().slideUp();$(this).parent().prev().slideDown()});$(".pht_review .thumblist li a").click(function(){var $imgSrc=$(this).attr("data-big"),$thispar=$(this).parents("div.thumblist"),$bigImg=$thispar.siblings(".scroll_img").children("img");$(this).parent("li").addClass("cur").siblings("li").removeClass("cur");load_img($imgSrc,$bigImg,function(){autloadSource($bigImg,$imgSrc)})});$(".prev").click(function(event){if(!$(this).hasClass("cur")){var $oUl=$(this).siblings(".list").children("ul"),$liWid=$oUl.children("li").width()+4,$liNum=$oUl.children("li").length;$oUl.css("width",$liNum*$liWid);$oUl.children("li.cur").removeClass("cur").prev("li").addClass("cur");var $s_imgSrc=$oUl.children("li.cur").find("a").attr("data-big"),$bigImg=$(this).parent().siblings(".scroll_img").children(".scroll_big_img"),$curIdx=$oUl.children("li.cur").index();load_img($s_imgSrc,$bigImg,function(){autloadSource($bigImg,$s_imgSrc)});if($curIdx===0){$(this).addClass("cur")}if($(this).siblings(".recent").size()){if($curIdx<=4){$oUl.animate({left:0+"px"})}}else{if($(this).siblings(".mostHelpful").size()){if($liNum>2){var $this_idx=$curIdx-2;if($this_idx>0){$oUl.animate({left:-($this_idx*liWid)})}else{if($this_idx=="-2"){$oUl.animate({left:0+"px"})}}}else{$oUl.css("left",0)}}else{if($(this).siblings(".one_review").size()){if($curIdx<=7){$oUl.animate({left:0+"px"})}}}}}});$(".next").click(function(event){if(!$(this).hasClass("cur")){$(this).siblings("a").removeClass("cur");var $oUl=$(this).siblings(".list").children("ul"),$liWid=$oUl.children("li").width()+4,$liNum=$oUl.children("li").length;$oUl.css("width",$liNum*$liWid);var $idx=$oUl.children("li.cur").index();$idx++;var $curIdx=$idx%$liNum;$oUl.children("li.cur").removeClass("cur").next("li").addClass("cur");var $s_imgSrc=$oUl.children("li").eq($curIdx).children("a").attr("data-big"),$bigImg=$(this).parent().siblings(".scroll_img").children(".scroll_big_img");load_img($s_imgSrc,$bigImg,function(){autloadSource($bigImg,$s_imgSrc)});$oUl.children("li").eq($curIdx).addClass("cur");if($curIdx===0){$(this).siblings("a").addClass("cur")}if($(this).siblings(".recent").size()){if($liNum>5){var $this_idx=$curIdx-4;if($this_idx>0){$oUl.animate({left:-($this_idx*$liWid)})}else{if($this_idx=="-4"){$oUl.animate({left:0+"px"});$(this).siblings("a").addClass("cur")}}}}else{if($(this).siblings(".mostHelpful").size()){if($liNum>2){var $this_idx=$curIdx-2;if($this_idx>0){$oUl.animate({left:-($this_idx*$liWid)})}else{if($this_idx=="-2"){$oUl.animate({left:0+"px"});$(this).siblings("a").addClass("cur")}}}else{$oUl.css("left",0)}}else{if($(this).siblings(".one_review").size()){if($liNum>7){var $this_idx=$curIdx-5;if($this_idx>0){$oUl.animate({left:-($this_idx*$liWid)})}else{if($this_idx=="-5"){$oUl.animate({left:0+"px"});$(this).siblings("a").addClass("cur")}}}}}}}})},_bindReviews=function(){var $reviewContainer=$("#review-lists-container"),replyHtml;(function(){var lis=$("#rating-levels-container li"),starElements={"5":{element:null,percent:0,curPencent:0},"4":{element:null,percent:0,curPencent:0},"3":{element:null,percent:0,curPencent:0},"2":{element:null,percent:0,curPencent:0},"1":{element:null,percent:0,curPencent:0}};$.each(starElements,function(i,obj){var percentage;starElements[i].element=lis.eq(5-i);percentage=starElements[i].element.data("percentage");if($.isNumeric(percentage)){starElements[i].percent=percentage}});var timerId,curLi,allLoaded,step=1,showPercentage=function(){if(allLoaded){clearTimeout(timerId);return}allLoaded=true;timerId=setTimeout(showPercentage,48);for(var level in starElements){curLi=starElements[level];if(curLi.percent===0||(curLi.curPencent>=curLi.percent)){continue}curLi.curPencent=curLi.curPencent+step;if(curLi.curPencent>curLi.percent){curLi.curPencent=curLi.percent}curLi.element.find("i").css("width",curLi.curPencent+"%").end().find(".perc").html(curLi.curPencent);allLoaded=false}};showPercentage()}());(function(){$(".reviewDetail",$reviewContainer).each(function(){var $this=$(this),url;url=Pattaya.Global.Utils.format(_settings.reviewRootUrl+"/reviews/ajax/HelpfulHandler.ashx?Action=ShowHelpful&ReviewInfoPIN=text-{sku}-{reviewId}&jsoncallback=?",{sku:_sku,reviewId:$this.data("rid")});$.ajax({url:url,dataType:"json"}).done(function(data){$(".review_btn_comments .txt",$this).append(" (<span class='cnum'>"+data.Comments+"</span>)");$(".customer_reviews_ishelp .yes",$this).append(" (<span class='num'>"+data.Useful+"</span>)");$(".customer_reviews_ishelp .no",$this).append(" (<span class='num'>"+data.Useless+"</span>)")})})}());var loadCommentList=function(reviewId){var errorHtml='<div class="load_panel error">Sorry, there is an error happened</div>',format=Pattaya.Global.Utils.format,dtUtil=Pattaya.Global.Utils.DateTime;var url=format(_settings.reviewRootUrl+"/reviews/ajax/CommentsHandler.ashx?Action=ListCommentsByPage&ReviewInfoPIN=text-{sku}-{reviewId}&PageIndex={pageIndex}&PageSize={pageSize}&jsoncallback=?",{sku:_sku,reviewId:reviewId,pageIndex:1,pageSize:10});return $.ajax({url:url,dataType:"json",success:function(data){var replyTemplate='<div class="repeat_p {c}"><div class="repeat_arrow"><em class="arrline"></em><span class="arrow"></span></div><ul class="repeat_list">{list}</ul>{more}</div>',liTemplate='<li><div class="con"><p class="qcon">{replyInfo}</p></div><p class="oinfo">By <a href="{authorLink}" target="_blank">{replyAuthor}</a> on {replyDate}</p></li>',moreTemplate='<p class="repeat_more"><a href="{rLink}" target="_blank">View all {rCount} replies</a></p>';var cList=data.reviewsComments;if(cList&&cList.length>0){var liHtml="";for(var i=0;i<cList.length;i++){var cItem=cList[i];liHtml+=format(liTemplate,{replyInfo:cItem.CommentContent,replyAuthor:cItem.UserName,replyDate:dtUtil.dateFormat(dtUtil.parseWCFDate(cItem.PostDateTime),"mm/dd/yyyy HH:MM"),authorLink:format(_settings.reviewRootUrl+"/reviews/u/{0}",cItem.UserName)})}var moreHtml="";if(data.totalCount>data.pageSize){moreHtml+=format(moreTemplate,{rLink:format(_settings.reviewRootUrl+"/reviews/text/{sku}/{reviewId}",{sku:_sku,reviewId:reviewId}),rCount:data.totalCount})}replyHtml=format(replyTemplate,{list:liHtml,more:moreHtml,c:""})}else{replyHtml=format(replyTemplate,{list:"",more:"",c:"hidden"})}},error:function(){replyHtml=errorHtml}})};$(".fb",$reviewContainer).click(function(){var $reviewDetail=$(this).closest(".reviewDetail"),link=window.location.href,picture=$(".product-small-images .hovered img").attr("src"),name=$.trim($("h1").text()),caption=Pattaya.Mall.Product.Detail.Lang.By+" "+$(".author a",$reviewDetail).text(),description="";description+=$reviewDetail.find(".pros").text()+" ";description+=$reviewDetail.find(".cons").text()+" ";description+=$reviewDetail.find(".other").text();var newUrl=_settings.fb.seedUrl;newUrl+="?app_id="+_settings.fb.app_id+"&";newUrl+="redirect_uri="+encodeURIComponent(_settings.fb.redirect_uri)+"&";newUrl+="link="+encodeURIComponent(link)+"&";newUrl+="picture="+encodeURIComponent(picture.indexOf("//")==0?"http:"+picture:picture)+"&";newUrl+="name="+name.replace(/\s/,"+")+"&";newUrl+="caption="+caption.replace(/\s/,"+")+"&";newUrl+="description="+description+"&";newUrl+="display=popup";window.open(newUrl,"fbWin","location=no, toolbar=no, resizable=yes, scrollbars=yes, directories=no, status=no, width=500, height=400, top=200")});$(".review_btn_comments",$reviewContainer).click(function(){var lang=Pattaya.Mall.Product.Detail.Lang;var $reviewDetail=$(this).closest(".reviewDetail"),$reviewsRepeatBox=$(".reviews_comment_repeat",$reviewDetail),replyOpeHtml='<div class="repeat_s"><div><textarea class="text autoTextarea" style="height: 50px;"></textarea></div><div class="mar_t10"><a href="javascript:;" class="btn_review_s">'+lang.Submit+'</a><span class="error hidden"></span></div></div>',loadingHtml='<div class="load_panel"><span class="icon_loader">'+lang.Loading+"...</span></div>",reivewId=$reviewDetail.data("rid");if($reviewsRepeatBox.is(":hidden")){$reviewsRepeatBox.html(loadingHtml).show();loadCommentList(reivewId).done(function(data){$(".cnum",$reviewDetail).text(data.totalCount)}).always(function(){var html=replyHtml+replyOpeHtml;$reviewsRepeatBox.html(html)})}else{$reviewsRepeatBox.hide()}return false});$(".yes, .no",$reviewContainer).click(function(){var lang=Pattaya.Mall.Product.Detail.Lang;var $this=$(this),url,voteType="";if($this.hasClass("disable")){return false}else{$this.addClass("disable")}var exePopEffect=function(){var $target=$(".curstatus",$this);$target.show();setTimeout(function(){$target.animate({top:$target.position().top-10,opacity:0},400,function(){$target.hide()})},500)},success=function(){var $num=$this.find(".num"),num=parseInt($num.text(),10);if(isNaN(num)){return}$num.text(num+1);exePopEffect()},error=function(msg){Pattaya.Global.UI.alert(msg,lang.Warning)};if($this.hasClass("yes")){voteType="Useful"}else{if($this.hasClass("no")){voteType="Useless"}}url=Pattaya.Global.Utils.format(_settings.reviewRootUrl+"/reviews/ajax/HelpfulHandler.ashx?Action=SaveHelpful&VoteType={voteType}&ReviewInfoPIN=text-{sku}-{reviewId}&jsoncallback=?",{sku:_sku,reviewId:$this.closest(".reviewDetail").data("rid"),voteType:voteType});$.ajax({url:url,dataType:"json"}).done(function(data){if(data.Code==="0x80040009"){success()}else{if(data.UserLogged===0){Pattaya.LoginOrSignUp.login()}else{if(data.Code=="0x80040008"){error(lang.YouToldUs)}else{if(data.LongMessage){error(data.LongMessage)}}}$this.removeClass("disable")}});return false});$reviewContainer.on("paste cut keyup",".autoTextarea",function(){var _this=this,style=_this.style,minHeight,scrollHeight,height;minHeight=$(_this).data("minHeight");if(!minHeight){minHeight=$(_this).data("minHeight",$(_this).height()).data("minHeight")}if(!$.browser.msie){style.height="0"}scrollHeight=_this.scrollHeight;if(scrollHeight<minHeight){height=minHeight}else{height=scrollHeight}style.height=height+"px"});$reviewContainer.on("click",".btn_review_s",function(){var $this=$(this),$reviewDetail=$this.closest(".reviewDetail"),$reviewsRepeatBox=$(".reviews_comment_repeat",$reviewDetail),$text=$("textarea",$reviewDetail),$error=$(".repeat_s .error",$reviewDetail),repliedContent="",reivewId=$reviewDetail.data("rid"),lang=Pattaya.Mall.Product.Detail.Lang;repliedContent=$.trim($text.val());if(repliedContent.length==0){$error.text(lang.PleaseInputYourReply).show();$text.focus();return}else{if(repliedContent.length>500){$error.text(lang.InputNoMoreThan).show();$text.focus();return}}var url=Pattaya.Global.Utils.format(_settings.reviewRootUrl+"/reviews/ajax/CommentsHandler.ashx?Action=SaveComments&ReviewInfoPIN=text-{sku}-{reviewId}&jsoncallback=?",{sku:_sku,reviewId:$reviewDetail.data("rid")});$.ajax({url:url,data:{reviewCommentTextarea:repliedContent,QID:0,cbEmailSubscription:0},dataType:"json",beforeSend:function(){$this.addClass("disabled")}}).done(function(data){if(data.UserLogged===0){Pattaya.LoginOrSignUp.login()}else{if(data.error===0){loadCommentList(reivewId).done(function(data){$text.val("");$(".cnum",$reviewDetail).text(data.totalCount)}).always(function(){$reviewsRepeatBox.find(".repeat_p").remove().end().prepend(replyHtml);$error.hide()})}else{if(data.error===1){if(data.content){$error.text(data.content).show()}}else{if(data.LongMessage){$error.text(data.LongMessage).show()}}}}}).fail(function(){$error.text(lang.UnknownErrorHappened).show()}).always(function(){$this.removeClass("disabled")})})},_loadDiscussions=function(){var jqxhr=$.ajax({url:_settings.forumServiceUrl+"?Action=GetThreadBySku&&jsoncallback=?",data:{SKU:_sku,pageIndex:1,pageSize:10},dataType:"json"}).done(function(data){$("#discussions-loading").remove();_interceptRequestResult(data,function(){var container=$("#discussions-container");if(!data.ThreadsList||data.ThreadsList.length===0){return}var $this=_this(),str="",format=Pattaya.Global.Utils.format,dtUtil=Pattaya.Global.Utils.DateTime;$.each(data.ThreadsList,function(index,thread){str+=format('<li><a href="{discussionUrl}" target="_blank">{subject}</a> ({userName}, {postedDate},{postCount} {textReplies},{viewCount} {textViews})</li>',{subject:thread.Subject,userName:thread.Username,postedDate:dtUtil.dateFormat(dtUtil.parseWCFDate(thread.Timestamp),"mm/dd/yyyy"),postCount:thread.PostCount,viewCount:thread.ViewCount,textReplies:$this.Lang.DiscussionReplies,textViews:$this.Lang.DiscussionViews,discussionUrl:thread.ThreadUrl})});container.html(str)})}).fail(function(){$("#discussions-loading").remove()});return jqxhr},_loadTag=function(){var existingTags=[];$("#tag-cloud>li>a").each(function(index,ele){existingTags.push($.trim($(ele).text()))});var _addTagEvent=function(e){var txt=$("#txt-add-tag"),tag=$.trim(txt.val());if(tag===""){txt.val("");return}$.ajax({url:_settings.addTagUrl,type:"POST",data:{tag:tag}}).done(function(data){if(data&&data.success){txt.val("");if(!Pattaya.Global.Utils.contains(existingTags,tag)){existingTags.push(tag);var format=Pattaya.Global.Utils.format;var str=format('<li><a href="{url}" class="{sizeStyle} {colorStyle}" target="_blank">{tag}</a></li>',{tag:tag,url:data.searchLink,sizeStyle:Math.ceil(Math.random()*5),colorStyle:Math.ceil(Math.random()*6)});$("#tag-cloud").append(str)}}})};$("#btn-add-tag").bind("click",_addTagEvent);$("#txt-add-tag").bind("keydown",function(e){if(e.keyCode===13){_addTagEvent(e)}})},_biTracking=function(){var trackingSKU=$.query.get("sourceSKU");if(trackingSKU===""){return}trackingSKU=parseInt(trackingSKU,10);if(isNaN(trackingSKU)){return}var url=_settings.biTrackingRootUrl+"counter?json=";url+=encodeURI($.stringify([{category:"Recommend",name:"Detail - View Detail",params:{url:window.location.href,sourceSKU:trackingSKU,targetSKU:parseInt(_sku,10)},clickCount:1,behavior:1}]));url+="&jsoncallback=?";$.ajax({url:url,dataType:"json"})},_getRecommendedPro=function(){if(!_settings.recommendProductSettings.url){return}var _slidesByDiscussions=function(){$("#proBoxByDiscussions").slides({play:3000,pause:1000,slideSpeed:600,hoverPause:true,paginationClass:"page",generateNextPrev:true,currentClass:"choose",effect:"slide"})};var _slidesByOverView=function(){$("#proBoxByOverView").slides({play:0,pause:0,slideSpeed:600,hoverPause:true,generatePagination:false,generateNextPrev:true,currentClass:"choose",effect:"slide",animationComplete:function(i){$("#currentPage").html(i)}})};var renderRPByOverview=function(products,options){if($("#proBoxByOverView").length>0&&products.length>0){var dataCountByOverView=products.length,itemPanelByOverView=$("#recommendProductItemByOverView").html(),ulHtmlByOverView="",timesByOverView=(dataCountByOverView%5==0?Math.floor(dataCountByOverView/5):Math.floor(dataCountByOverView/5)+1);if(options&&options.title){$("#ovTitle").text(options.title)}$("#totalPage").html(timesByOverView);for(var i=1;i<=timesByOverView;i++){var itemListByOverView="",j=i*5;if(j>dataCountByOverView){j=dataCountByOverView}var arrayByOverView=new Array();for(var k=(i-1)*5;k<j;k++){arrayByOverView.push(products[k])}ulHtmlByOverView+="<ul class='productList sublist'>";var proUrl,urlParser,itemHtmlByOverView;$.each(arrayByOverView,function(index,value){proUrl=value.rewriteUrl;itemHtmlByOverView=itemPanelByOverView.replace(/_proLink_/g,proUrl);itemHtmlByOverView=itemHtmlByOverView.replace("_imgSrc_",value.imageUrl);itemHtmlByOverView=itemHtmlByOverView.replace("_imgAlt_",value.headLine);itemHtmlByOverView=itemHtmlByOverView.replace(/_title_/g,value.headLine);itemHtmlByOverView=itemHtmlByOverView.replace("_name_",value.shortHeadline);itemHtmlByOverView=itemHtmlByOverView.replace("_price_",value.price);itemHtmlByOverView=itemHtmlByOverView.replace("_reviewUrl_",value.reviewUrl);itemHtmlByOverView=itemHtmlByOverView.replace("_ratingPer_",(parseFloat(value.avgRating)*100/5)+"%");itemHtmlByOverView=itemHtmlByOverView.replace("_avgRating_",value.avgRating);itemHtmlByOverView=itemHtmlByOverView.replace("_ratingPer_",value.ratingPer);itemHtmlByOverView=itemHtmlByOverView.replace("_reviewCount_",value.reviewCount);itemHtmlByOverView=itemHtmlByOverView.replace("_cartUrl_",value.cartUrl);if(value.isDeliveryTag){itemHtmlByOverView=itemHtmlByOverView.replace("_delivery_","");itemHtmlByOverView=itemHtmlByOverView.replace("_deliveryPlaceholder_","hidden")}else{itemHtmlByOverView=itemHtmlByOverView.replace("_delivery_","hidden");itemHtmlByOverView=itemHtmlByOverView.replace("_deliveryPlaceholder_","")}itemListByOverView+=itemHtmlByOverView});ulHtmlByOverView+=itemListByOverView+"</ul>"}var $html=$(ulHtmlByOverView);if(options&&options.isBFD){$html.find(".noBFD").remove()}$("#carouselDivByOverView").html($html);$("#proBoxByOverView").show();_slidesByOverView()}};var renderRPByDiscussions=function(products,options){var lang=Pattaya.Mall.Product.Detail.Lang;if($("#proBoxByDiscussions").length>0&&products.length>0){var dataCountByDiscussions=products.length,itemPanelByDiscussions=$("#recommendProductItemByDiscussions").html(),ulHtmlByDiscussions="",timesByDiscussions=(dataCountByDiscussions%5==0?Math.floor(dataCountByDiscussions/5):Math.floor(dataCountByDiscussions/5)+1);if(options&&options.title){$("#dTitle").text(options.title)}for(var i=1;i<=timesByDiscussions;i++){var itemListByDiscussions="",j=i*5;if(j>dataCountByDiscussions){j=dataCountByDiscussions}var arrayByDiscussions=new Array();for(var k=(i-1)*5;k<j;k++){arrayByDiscussions.push(products[k])}ulHtmlByDiscussions+="<ul class='productList sublist'>";var proUrl,urlParser,itemHtmlByDiscussions;$.each(arrayByDiscussions,function(index,value){proUrl=value.rewriteUrl;itemHtmlByDiscussions=itemPanelByDiscussions.replace(/_proLink_/g,proUrl);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_imgSrc_",value.imageUrl);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_imgAlt_",value.headLine);itemHtmlByDiscussions=itemHtmlByDiscussions.replace(/_title_/g,value.headLine);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_name_",value.shortHeadline);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_price_",value.price);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_reviewUrl_",value.reviewUrl);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_ratingPer_",(parseFloat(value.avgRating)*100/5)+"%");itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_avgRating_",value.avgRating);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_ratingPer_",value.ratingPer);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_reviewCount_",value.reviewCount);itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_cartUrl_",value.cartUrl);if(value.isDeliveryTag){itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_delivery_","");itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_deliveryPlaceholder_","hidden")}else{itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_delivery_","hidden");itemHtmlByDiscussions=itemHtmlByDiscussions.replace("_deliveryPlaceholder_","")}itemListByDiscussions+=itemHtmlByDiscussions});ulHtmlByDiscussions+=itemListByDiscussions+"</ul>"}var $html=$(ulHtmlByDiscussions);if(options&&options.isBFD){$html.find(".noBFD").remove()}$("#carouselDivByDiscussions").html($html);$("#proBoxByDiscussions").show();_slidesByDiscussions()}};var recordProsByDiscussions=function(products){_prosByUserBuyHistory=products};if(Pattaya.BFD.isGetRPByBFD()){var bfd_show_vav=function(skus){renderRPByOverview(skus,{title:Pattaya.Mall.Product.Detail.Lang.CustomersWhoViewedThisItemAlsoViewed,isBFD:true})};var bfd_show_bab=function(skus){renderRPByDiscussions(skus,{title:Pattaya.Mall.Product.Detail.Lang.CustomersWhoBoughtThisItemAlsoBought,isBFD:true})};var bfd_show_bab2=function(skus){recordProsByDiscussions(skus)};Pattaya.BFD.setMergeRequest({bfd_show_bab:bfd_show_bab,bfd_show_vav:bfd_show_vav,bfd_show_bab2:bfd_show_bab2})}else{$.ajax({url:_settings.recommendProductSettings.url,data:{sku:_settings.recommendProductSettings.sku,titleSize:_settings.recommendProductSettings.titleSize},type:"GET",global:false,dataType:"json",success:function(data){if(typeof data==="object"&&data.success){renderRPByDiscussions(data.discussionsproducts);renderRPByOverview(data.overviewproducts)}else{}},error:function(){}})}},_bindPMAndRE=function(){var $reportError,$reportPriceMatch,$reportErrorDialog,$reportPriceMatchDialog,EventHiddenAddTagTip,reportErrorContent,priceMatchContent,errorclass="inputError";function HiddenAddTagTip(){var obj=$("#AddYourTagsErrorMsg");obj.fadeOut("slow",function(){obj.html("");obj.show()})}function tipSuccess(msg){var tipsPanel=$("#tipsPanel").html(),$tip=$(tipsPanel.replace("_msg_",msg));var tips=Pattaya.Global.UI.dialog($tip,{buttons:false,customClass:"pattaya_tips",width:350,type:"tip",modal:false,autoClose:5000});$tip.find(".close").click(function(){tips.close()})}function changeValidationCode(){$(".validationcode").attr("src",_settings.validationCodeUrl+"?d="+new Date().getTime())}var emailValid=function($email){var lang=Pattaya.Mall.Product.Detail.Lang;var msgPanel=$("#errorInfoMsgWrap"),msg=$("#errorInfoMsg"),email=$.trim($email.val());msgPanel.hide();msg.html("");$("."+errorclass).removeClass(errorclass);if(email.length==0){msg.html(lang.EmailIsRequired);msgPanel.show();$email.addClass(errorclass)}else{if(!Pattaya.Global.Validation.email(email)){msg.html(lang.EmailAppearsToBeInvalid+"<br />");msgPanel.show();$email.addClass(errorclass)}else{return true}}return false},urlValid=function($url){var lang=Pattaya.Mall.Product.Detail.Lang;var msgPanel=$("#errorInfoMsgWrap"),msg=$("#errorInfoMsg"),url=$.trim($url.val());msgPanel.hide();msg.html("");$("."+errorclass).removeClass(errorclass);if(url.length==0){msg.append(lang.URLIsRequired+"<br />");msgPanel.show();$url.addClass(errorclass)}else{if(!Pattaya.Global.Validation.url(url)){msg.append(lang.UrlAppearsToBeInvalid+"<br />");msgPanel.show();$url.addClass(errorclass)}else{return true}}return false},reportErrorSubmitValidation=function(){var result=false,emailobj=$("#txtbYourEmailAdddress");emailobj.removeClass(errorclass);if(emailValid(emailobj)){result=true;$("#errorInfoMsgWrap").hide()}return result},reporErrorSubmit=function(){var lang=Pattaya.Mall.Product.Detail.Lang,format=Pattaya.Global.Utils.format;if(!reportErrorSubmitValidation()){return}var msgwarp=$reportError.find("#errorInfoMsgWrap");var msg=$reportError.find("#errorInfoMsg");$reportErrorDialog.dialog.append('<div class="showloader overlay loadModal"></div>');$reportErrorDialog.overlay.off("click");$.post(_settings.reportErrorSubmitUrl,{SKU:_sku,Name:$reportError.find("#txtbYourName").val(),EmailAdddress:$reportError.find("#txtbYourEmailAdddress").val(),TypeOfError:$reportError.find("#selTypeOfError").val(),Notes:$reportError.find("#txtbNotes").val(),ValidationCode:$reportError.find("#txtbCode").val()},function(d){switch(d.state){case -2:msg.html(lang.ValidationCodeIsWrong);break;case -1:msg.html(lang.VerificationCodeCantForEmpty);break;case 1:$reportErrorDialog.close();tipSuccess(format('<p style="font-weight:bold">{0}</p><p sytle="font-size:12px">{1}</p>',lang.YourReportHasBeenSent,lang.WeReallyAppreciateYourHelp));break;default:msg.html(lang.ServerError)}if(d.state!=1){msgwarp.show();changeValidationCode()}$reportErrorDialog.dialog.find(".loadModal").remove()})},reportLowerPriceSubmitValidation=function(){var result=false,emailobj=$reportPriceMatch.find("#txtbYourEmailAdddress"),urlobj=$reportPriceMatch.find("#txtbURLWhereSoldForLess");$("."+errorclass).removeClass(errorclass);if(emailValid(emailobj)&&urlValid(urlobj)){$("#errorInfoMsgWrap").hide();result=true}else{$("#errorInfoMsgWrap").show()}return result},priceMatchSubmit=function(){var lang=Pattaya.Mall.Product.Detail.Lang,format=Pattaya.Global.Utils.format;if(!reportLowerPriceSubmitValidation()){return}var msgwarp=$reportPriceMatch.find("#errorInfoMsgWrap");var msg=$reportPriceMatch.find("#errorInfoMsg");$reportPriceMatchDialog.dialog.append('<div class="showloader overlay loadModal"></div>');$reportPriceMatchDialog.overlay.off("click");$.post(_settings.priceMatchSubmit,{SKU:_sku,Name:$reportPriceMatch.find("#txtbYourName").val(),EmailAdddress:$reportPriceMatch.find("#txtbYourEmailAdddress").val(),URL:$reportPriceMatch.find("#txtbURLWhereSoldForLess").val(),Notes:$reportPriceMatch.find("#txtbNotes").val(),ValidationCode:$reportPriceMatch.find("#txtbCode").val()},function(d){switch(d.state){case -2:msg.html(lang.ValidationCodeIsWrong);break;case -1:msg.html(lang.VerificationCodeCantForEmpty);break;case 1:$reportPriceMatchDialog.close();tipSuccess(format('<p style="font-weight:bold">{0}</p><p sytle="font-size:12px">{1}</p>',lang.YourReportHasBeenSent,lang.YourReportOnThisProductHasBeenSentToUs));break;default:msg.html(lang.ServerError)}if(d.state!=1){msgwarp.show();changeValidationCode()}$reportPriceMatchDialog.dialog.find(".loadModal").remove()})},ShowValidationTip=function(isval){var objwarp=$report.find("#errorInfoMsgWarp"),obj=$report.find("#errorInfoMsg");if(isval){objwarp.hide();obj.html("")}else{objwarp.show()}};$("#btn-add-reportError").click(function(){var lang=Pattaya.Mall.Product.Detail.Lang;if(!reportErrorContent){$reportErrorDialog=Pattaya.Global.UI.dialog("ajax:"+_settings.reportErrorUrl,{buttons:false,title:lang.ReportError,ajax:{loadWidth:200,loadHeight:100,done:function(d,data){reportErrorContent=$(data);reportErrorContent.find("#linkSubmit").click(reporErrorSubmit).end().find(".Cancel").click(function(){$reportErrorDialog.close()}).end().find("#txtbYourEmailAdddress").blur(function(){emailValid($(this))}).end().find(".changevode").click(changeValidationCode);$reportError=reportErrorContent.clone(true);d.html($reportError);changeValidationCode()}}})}else{$reportError=reportErrorContent.clone(true);$reportErrorDialog=Pattaya.Global.UI.dialog($reportError,{buttons:false,title:lang.ReportError});changeValidationCode()}});$("#btn-add-pricematch").click(function(){var lang=Pattaya.Mall.Product.Detail.Lang;if(!priceMatchContent){$reportPriceMatchDialog=Pattaya.Global.UI.dialog("ajax:"+_settings.reportLowerPriceUrl,{buttons:false,title:lang.PriceMatch,ajax:{loadWidth:200,loadHeight:100,done:function(d,data){priceMatchContent=$(data);priceMatchContent.find(".Submit").click(priceMatchSubmit).end().find(".Cancel").click(function(){$reportPriceMatchDialog.close()}).end().find("#txtbYourEmailAdddress").blur(function(){emailValid($(this))}).end().find("#txtbURLWhereSoldForLess").blur(function(){urlValid($(this))}).end().find("#txtbYourEmailAdddress").blur(function(){emailValid($(this))}).end().find(".changevode").click(changeValidationCode);$reportPriceMatch=priceMatchContent.clone(true);d.html($reportPriceMatch);changeValidationCode()}}})}else{$reportPriceMatch=priceMatchContent.clone(true);$reportPriceMatchDialog=Pattaya.Global.UI.dialog($reportPriceMatch,{buttons:false,title:lang.PriceMatch});changeValidationCode()}});$("#btnAddYourTagsSubmit").click(function(){var lang=Pattaya.Mall.Product.Detail.Lang;var $msgtip=$("#AddYourTagsErrorMsg");if($.trim($("#txtbAddYourTags").val())==""){if(EventHiddenAddTagTip){clearTimeout(EventHiddenAddTagTip)}$msgtip.html(lang.PleaseInputAnEnglishWord);$msgtip.css("color","red");return}$.post(_settings.addProductTagsUrl,{sku:_sku,tagName:$("#txtbAddYourTags").val().toLowerCase()},function(d){if(d.issuccess){$msgtip.html($.trim(d.msg));$msgtip.css("color","green");EventHiddenAddTagTip=setTimeout(function(){HiddenAddTagTip()},5000)}else{if(EventHiddenAddTagTip){clearTimeout(EventHiddenAddTagTip)}$msgtip.html($.trim(d.msg));$msgtip.css("color","red")}})})},_bindAddToWishList=function(){var btnAddToWishList=$("#btn-add-wishlist");var query=window.location.search.substr(1);var rt=Pattaya.Mall.CommonMethod.urlParam(query,"rt");var k=Pattaya.Mall.CommonMethod.urlParam(query,"k");var t=Pattaya.Mall.CommonMethod.urlParam(query,"t");var u=Pattaya.Mall.CommonMethod.urlParam(query,"u");if(rt){btnAddToWishList.attr("data-rt",rt).attr("data-k",k).attr("data-t",4).attr("data-u",u)}btnAddToWishList.data("settings",{left:657}).data("ifmWidth",503);btnAddToWishList.data("wish-callback",function(data){var autoClose=false;if(data.autoClose){autoClose=data.autoClose}if(data.ifmHeight){this.css("height",data.ifmHeight)}btnAddToWishList.addClass("aw_success").attr("disabled","disabled").find(".text").text(Pattaya.Mall.Product.Detail.Lang.AddSucceeded);if(autoClose){setTimeout(function(){$("[id^=pattaya-popup-]:visible").hide()},autoClose)}btnAddToWishList.removeClass("add-wish")});btnAddToWishList.prop("disabled",false)},_bindDelivery=function(){Pattaya.Global.UI.dropdown("#dDropPanel",{type:"menu",delay:200,fx:{type:"none"}})},_loadSkuAddDate=function(){return $.getJSON(_settings.proInfoRealtimeUrl,{skus:_sku}).done(function(d){if(d.success){var data=d.data[0];if(data){if(data.adddate){$("#adddate").text(data.adddate)}}}})},_correctErrors=function(){var $edit,customizedInfo=Pattaya.Global.Page.Header.CustomizedInfo,cicid,lang=_settings.correctErrors.lang;var getCicIdByCi=function(ci){return ci&&ci.customer&&ci.customer.CICID},correct=function(){$edit.parent().show();$edit.on("click",function(){if(!cicid){Pattaya.LoginOrSignUp.login();return false}var url=$edit.attr("href");if(!url){return}url+=Pattaya.Global.Utils.format("/?Lang={lang}&SKU={sku}&CICID={cicid}",{lang:lang,sku:_sku,cicid:cicid});var loaded=function(){var longTitle=$("#headline").html(),shortTitle=Pattaya.Global.Utils.decodeHtml(_settings.correctErrors.shortHeadLine),overview=$("#overview-detailinfo").html()||"",specitation=$("#specification-detailinfo").html()||"",enLongTitle=Pattaya.Global.Utils.decodeHtml(_settings.correctErrors.enLongTitle),enShortTitle=Pattaya.Global.Utils.decodeHtml(_settings.correctErrors.enShortTitle),enOverview=Pattaya.Global.Utils.decodeHtml($("#enOverview").val()),enSpecitation=Pattaya.Global.Utils.decodeHtml($("#enSpecification").val()),encategoryPath=Pattaya.Global.Utils.decodeHtml($("#encategoryPath").val());var crIframe=document.getElementById("correct-errors-iframe");document.domain=Pattaya.Global.Utils.getTopLevelDomainName();if(crIframe.contentWindow.setValue){crIframe.contentWindow.setValue({_longTitle_other:longTitle,_shortTitle_other:shortTitle,_overview_other:overview,_specifications_other:specitation,_longTitle_en:enLongTitle,_shortTitle_en:enShortTitle,_overview_en:enOverview,_specifications_en:enSpecitation,_categoryPath_en:encategoryPath});$(crIframe).load(loaded)}else{crDialog.dialog.find(".bd_iframe, iframe, .pattaya-dialog-iframe").css({width:520,height:300});crDialog.dialog.css({width:520});crDialog.draw()}};var crDialog=Pattaya.Global.UI.dialog("iframe:"+url,{title:Pattaya.Mall.Product.Detail.Lang.CorrectErrorTitle,buttons:false,width:750,height:600,overlayClose:false,iframe:{id:"correct-errors-iframe",loadWidth:720,loadHeight:570,loaded:loaded}});return false})};if(_settings.correctErrors.enable!==true){return}if(!lang||lang=="en"){return}$edit=$("#correctErrors");if($edit.length==0){return}if(customizedInfo.isLoaded()){var ci=customizedInfo.get();cicid=getCicIdByCi(ci);correct()}else{customizedInfo.attachDone(function(data){cicid=getCicIdByCi(data);correct()})}},_switchLang2=function(){var proInfoLang=_settings.correctErrors.lang,_lang=Pattaya.Mall.Product.Detail.Lang;if(!proInfoLang||proInfoLang=="en"){return}$("#tabProInfo").on("click",".switchLang",function(){var that=$(this),container=that.parent().find(".infoContainer");if(container.data("showing-lang")=="en"){container.html(container.data("text-other"));container.data("showing-lang",proInfoLang);that.find(".t").text(_lang.ViewInEnglish)}else{container.html(container.data("text-en"));container.data("showing-lang","en");that.find(".t").text(_lang.ViewInOtherLang)}});$(".switchLang").each(function(){var that=$(this),container=that.parent().find(".infoContainer");if(container.length==0){return}container.data("showing-lang",proInfoLang).data("text-en",function(){if(container.attr("id")=="overview-detailinfo"){return Pattaya.Global.Utils.decodeHtml($("#enOverview").val())}else{if(container.attr("id")=="specification-detailinfo"){return Pattaya.Global.Utils.decodeHtml($("#enSpecification").val())}}}).data("text-other",container.html());that.show().find(".t").text(_lang.ViewInEnglish)})},_switchLang=function(){var proInfoLang=_settings.correctErrors.lang,_lang=Pattaya.Mall.Product.Detail.Lang;if(!proInfoLang||proInfoLang=="en"){return}var containers=$(".tab_content").find(".infoContainer");$("#tabProInfo").on("click",".switchLang",function(){var that=$(this);containers.each(function(){var container=$(this);if(container.data("showing-lang")=="en"){container.html(container.data("text-other"));container.data("showing-lang",proInfoLang);that.find(".t").text(_lang.ViewInEnglish)}else{container.html(container.data("text-en"));container.data("showing-lang","en");that.find(".t").text(_lang.ViewInOtherLang)}})});$(".switchLang").each(function(){var that=$(this);if(containers.length==0){return}containers.each(function(){var container=$(this);container.data("showing-lang",proInfoLang).data("text-en",function(){if(container.attr("id")=="overview-detailinfo"){return Pattaya.Global.Utils.decodeHtml($("#enOverview").val())}else{if(container.attr("id")=="specification-detailinfo"){return Pattaya.Global.Utils.decodeHtml($("#enSpecification").val())}}}).data("text-other",container.html())});that.show().find(".t").text(_lang.ViewInEnglish)})},_bingAttrFilter=function(){var oPros=_settings.productAttrs,pros,attrPanel=$("#attrList"),attrCount=oPros.length;var _resetAttrFilter=function(oAttrs){var newAttrs=[];$.each(oAttrs,function(i,a){var attr={},attrOpsIds=[];$.each(a.Attrs,function(i,a_1){attrOpsIds.push(a_1.AttrOpsId)});attr.Sku=a.Sku;attr.AttrOpsIds=attrOpsIds;attr.Url=a.Url;newAttrs.push(attr)});return newAttrs},checkIsValidGroup=function(a){var result=false;$.each(pros,function(i,pro){var temp=true;$.each(a,function(i,v){if($.inArray(v,pro.AttrOpsIds)==-1){temp=false;return false}});if(temp){result=true;return false}});return result},checkAttrIsEnabled=function(){var curAttrs={},panel=$("a",attrPanel);panel.filter(".selected").each(function(){var _this=$(this);curAttrs[_this.data("attrdef")]=_this.data("attrops")});panel.filter(":not(.selected)").each(function(){var _this=$(this),oAttr=[],curAttrsClone=$.extend({},curAttrs);curAttrsClone[_this.data("attrdef")]=_this.data("attrops");$.each(curAttrsClone,function(i,v){oAttr.push(v)});if(!checkIsValidGroup(oAttr)){_this.addClass("disabled")}else{_this.removeClass("disabled")}})},unableOtherOper=function(){var btnAddToCart=$("#btn-add-to-cart"),href=btnAddToCart.attr("href");btnAddToCart.data("href",href).addClass("disable").attr("href","javascript:void(0)")},enableOtherOper=function(){var btnAddToCart=$("#btn-add-to-cart"),href=btnAddToCart.data("href");btnAddToCart.removeClass("disable").attr("href",href)};pros=_resetAttrFilter(oPros);checkAttrIsEnabled();$("a",attrPanel).click(function(){var that=$(this);if(that.hasClass("disabled")){return false}if(that.hasClass("selected")){that.removeClass("selected")}else{var curattrdef=that.data("attrdef");$("a.selected[data-attrdef='"+curattrdef+"']",attrPanel).removeClass("selected");that.addClass("selected")}checkAttrIsEnabled();var lastGroup=[];$("a.selected",attrPanel).each(function(){lastGroup.push($(this).data("attrops"))});var proSku="";var url="";$.each(pros,function(i,pro){var arrGroup=pro.AttrOpsIds;if(lastGroup.join(",")==arrGroup.join(",")){proSku=pro.Sku;url=pro.Url;return false}});if(proSku){if(proSku==_sku){enableOtherOper();return false}$("#operPanel").show();enableOtherOper();window.location.href=url}else{unableOtherOper()}return false})},init=function(o){if(_isInitialized){return}$.extend(true,_settings,o);_preInit();_getRecommendedPro();if(_settings.usedAjaxToGetProDetailInfo){_loadProRealTimeInfo().always(function(){_loadQtyControl(1,999);_loadPriceSelection()});_loadProductDirectInfo();_loadCountryInfo()}else{_loadSkuAddDate();_loadQtyControl(1,999);_loadPriceSelection()}_loadAddToCart();_loadPerfectMatch();_loadTabs();_loadImageViews();_bindNewReviews();_loadDiscussions();_biTracking();_bindPMAndRE();_isInitialized=true;_bindAddToWishList();_bindDelivery();_correctErrors();_switchLang();_bingAttrFilter()};productDetail.init=init;$.extend(true,_this(),productDetail)}(this,Pattaya,jQuery));
